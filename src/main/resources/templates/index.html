<!DOCTYPE html>
<html xmlns:th="http://thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>Title</title>
    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/4.0.0-2/css/bootstrap.min.css} "/>
</head>
<body>
<form action="/book-create" method="post" class="ml-4 mt-4">
    <div class="form-group row">
        <label class="col-sm-2 col-form-label ml-3" for="titleField">Title</label>
        <input class="col-sm-4 form-control" id="titleField" name="title"
               placeholder="Enter title">
    </div>
    <div class="form-group row">
        <label class="col-sm-2 col-form-label ml-3" for="isbnField">ISBN</label>
        <input class="col-sm-4 form-control" id="isbnField" name="isbn"
               placeholder="Enter ISBN">
    </div>
    <div class="form-group row">
        <label class="col-sm-2 col-form-label ml-3" for="authorField">Author</label>
        <input class="col-sm-4 form-control" id="authorField" name="author"
               placeholder="Enter author">
    </div>

    <button type="submit" class="btn btn-primary ml-1">Save</button>
</form>

<form th:action="@{/filter}" method="get" class="ml-4 mt-2">
    <div class="form-group row">
        <label class="col-sm-2 col-form-label " for="isbnFind">Find by ISBN</label>
        <input type="text" class="col-sm-2 form-control" id="isbnFind" name="isbnFind" th:name="${isbnKey}">
        <label class="col-sm-1 col-form-label ml-1" for="isbnFind">Find by title</label>
        <input type="text" class="col-sm-3 form-control" id="titleFind" name="titleFind" th:name="${titleKey}">
        <button type="submit" value="Search" class="btn btn-primary btn-sm ml-1">Search</button>
        <button type="submit" value="Clear" class="btn btn-primary btn-sm ml-1"
                id="btnClear" onclick="clearSearch()">Clear</button>
    </div>

</form>


<div class="row col-sm-8 ml-2">
    <h1>Book list </h1>
    <br/>
        <table class="table table-striped table-bordered">
            <tr>
                <th>Title</th>
                <th>isbn</th>
                <th>Author</th>
            </tr>
            <tr th:each="b:${books}" th:field="${b}">
                <td th:text="${b.title}"></td>
                <td th:text="${b.isbn}"></td>
                <td th:text="${b.author}"></td>
            </tr>
        </table>
</div>

<script type="text/javascript">
    function clearSearch() {
        window.location = "[[@{/}]]";
    }
</script>
<script>
    $(function () {
        function getBooks() {
            var $books = $('#booksList');

            $.ajax({
                url: '/get-books',
                success: function (response) {
                    $books.empty();
                    response.forEach(function (book) {
                        $books.append('<tr><td>' + book.title + '</td><td>' + book.isbn + '</td><td>' + book.author + '</td></tr>');
                    })
                }
            });
        }

        $('#createBook').submit(function (e) {
            e.preventDefault();

            $.ajax({
                type: 'POST',
                url: '/book-create',
                dataType: 'json',
                data: JSON.stringify({
                    title: $(this).find('[name=title]').val(),
                    isbn: $(this).find('[name=isbn]').val(),
                    author: $(this).find('[name=author]').val(),
                }),
                beforeSend: function (xhr) {
                    xhr.setRequestHeader('Content-Type', 'application/json')
                },
                success: function (response) {
                    console.log(JSON.stringify(response));
                    getBooks();
                }
            });
        });

        $('#searchButton').click(function (e) {
            var $books = $('#booksList');

            var query = $('#searchBookId').val();
            $.ajax({
                url: '/get-books?name=' + query,
                success: function (response) {
                    $books.empty();
                    response.forEach(function (book) {
                        $books.append('<tr><td>' + book.title + '</td><td>' + book.isbn + '</td><td>' + book.author + '</td></tr>');
                    })
                }
            });
        });

    });
</script>
<!--<script th:src="@{/webjars/jquery/3.0.0/jquery.min.js}"></script>-->
<!--<script th:src="@{/webjars/popper.js/1.12.9-1/umd/popper.min.js}"></script>-->
<!--<script th:src="@{/webjars/bootstrap/4.0.0-2/js/bootstrap.min.js}"></script>-->
</body>
</html>